---
layout: home
title:
permalink: /
---

<div style="height: 20em;">
    <span id="weather">
    Meh :-)

    Nothing here yet, please check back later...
    </span>
    <button onclick="loadWeatherData()">Refresh</button>

</div>

<script>
    const weatherServiceUrl = '{{ site.weather_service_url }}';
    const weatherSpan = document.getElementById("weather");

    function loadWeatherData() {
        if (navigator.geolocation) {
            weatherSpan.innerHTML = "Loading weather data...";
            navigator.geolocation.getCurrentPosition(displayWeather);
        } else {
            weatherSpan.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    async function displayWeather(position) {
        let latLongCoords = position.coords.latitude + ',' + position.coords.longitude;
        weatherSpan.innerHTML = `Retrieving current temperature for ${latLongCoords}: `;
        try {
            const response = await fetch(`${weatherServiceUrl}/weather-at/${latLongCoords}`, {mode: 'cors'});
            const json = await response.json();
            weatherSpan.innerHTML = `<h3>${json.name}</h3></br>
                <h4>${json.main.temp}ËšC</h4></br>
                ${json.weather[0].description}</br>
                wind ${json.wind.speed}m/s from ${degToCompass(json.wind.deg)}`
        }
        catch(err) {
            weatherSpan.innerHTML = `Failed to retrieve temperature for ${latLongCoords} :-(`;
            console.log('Error: ', err)
        }
    }

    function degToCompass(num) {
        const val = Math.floor((num / 22.5) + 0.5);
        const arr = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW"];
        return arr[(val % 16)];
    }

    loadWeatherData();
</script>
